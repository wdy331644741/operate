## 网利宝重构用户中心---用户资金相关接口

接口调用方式：`RPC`

## 接口列表

- [转入转出资产数据](#转入转出资产数据)
- [账户充值](#账户充值)
- [确认充值](#确认充值)
- [充值结果查询](#充值结果查询)
- [用户提现](#用户提现)
- [提现费用](#提现费用)
- [交易记录](#交易记录)



用户信息相关接口
----------------

接口地址
> 域名/service.php?c=account

请求方式
> post

参数类型 (`Content-Type`)
>  application/json

登录状态
> 请求需要登录状态，cookie  SESSIONID=session_id


## 转入转出资产数据

说明：转入转出页面，用户一些重要数据接口


##### 请求参数

	{
        "jsonrpc": "2.0",
        "method": "assetFlowsLimit",
        "params": [],
        "id": 1
    }

##### 返回结果
    
	成功：
        {
          "jsonrpc": "2.0",
          "result": {
            "code": 0,
            "message": "success",
            "data": {
              "sell_overage": "5000000.00",     //买入页面，剩余份额
              "bank_overage": "50000.00",       //买入页面，银行卡剩余可支付 
              "avaliable_amount": "10000.00",   //转出页面，可转出资产
              "free_withdraw_num": 2,           //转出页面，本月剩余免费次数
              "withdraw_overage": "50000.00"    //转出页面，当日可转出
            }
          },
          "id": 1
        }
        
       
    失败：
        {
		  "jsonrpc": "2.0",
		  "error": {
		    "code": 1303,
		    "message": "未绑定银行卡"
		  },
		  "id": 1
		}
        
错误信息 | 错误码 | 错误说明
:--|:--|:--
用户未登录 | 1106 | 用户未登录或session已过期
未绑定银行卡 | 1303 | 用户没有绑定银行卡


## 账户充值

说明：发送充值短信验证码


##### 请求参数

	{
    	"jsonrpc": "2.0",
    	"method": "recharge",
    	"params": [{
    	    "cardno": "6214830121363633",
    	    "amount": 1,
    	    "trade_pwd": 123123           //功能一 不需要该参数
    	}],
    	"id": 1
    }

##### 返回结果
    
    针对功能一：
	成功：
        {
          "jsonrpc": "2.0",
          "result": {
            "code": 0,
            "message": "success",
            "order_id": "1468403569367604950" //充值订单号
          },
          "id": 1
        }
        
    针对功能二：
    成功：
        {
          "jsonrpc": "2.0",
          "result": {
            "code": 0,                       //只有两种可能 充值成功（0） 和处理中（1671）
            "message": "充值成功",            // 或 处理中（交易已提交，请稍后查询我的账户）
            "order_id": "1468403569367604950" //充值订单号
          },
          "id": 1
        }
       
    失败：
        {
		  "jsonrpc": "2.0",
		  "error": {
		    "code": 1303,
		    "message": "未绑定银行卡"
		  },
		  "id": 1
		}
        
错误信息 | 错误码 | 错误说明
:--|:--|:--
缺少必要参数 | 1000 | 缺少接口所需参数
用户未登录 | 1106 | 用户未登录或session已过期
充值金额不合法 | 1107 | 充值金额必须为整型并且大于最低限额（当前为10元）
密码输入错误 | 1203 | 交易密码输入错误
未设置交易密码 | 1300 | 用户未设置交易密码
用户未实名认证 | 1301 | 用户未实名认证
未绑定银行卡 | 1303 | 用户没有绑定银行卡
需要重新绑卡 | 1307 | 新通道下用户还未绑卡，需要重新绑卡
保存充值记录失败 | 1406 | mysql服务写入失败或充值失败
充值失败 | 1670 | 调用充值失败（失败原因不固定，以错误信息为准）
账号已冻结，请修改密码或稍后重试 | 1500 |  交易密码输入错误超过三次，冻结



## 确认充值

说明：配合[账户充值](#账户充值) 的功能一，来完成充值请求操作。充值成功或订单为处理中，接口数据会以成功的状态返回（也就是result）  充值失败或其他不可预期的失败则会以异常的形式抛出（也就是error）,该数据返回形式应用于所有有关充值相关的接口结果数据

##### 请求参数

	{
    	"jsonrpc": "2.0",
    	"method": "confirmPay",
    	"params": [{
    	    "order_id": "1468403569367604950",  //上个接口调用成功返回的订单号
    	    "sms_code": 1234,                   //银行发送的短信验证码
    	    "trade_pwd": 123123                 //交易密码
    	}],
    	"id": 1
    }

##### 返回结果

	成功：
        {
            "jsonrpc": "2.0",
            "result": {
                "code": 0,                        //充值成功（0）或 处理中（1671）两种情况
                "message": "充值成功",             // 或 交易已提交，请稍后查询我的账户（1671）
                "order_id": "1468403569367604950" //充值订单号
            },
            "id": 1
        }
       
    失败：
        {
		  "jsonrpc": "2.0",
		  "error": {
		    "code": 1000,
		    "message": "缺少必要参数"
		  },
		  "id": 1
		}
		
		
 错误信息 | 错误码 | 错误说明
 :--|:--|:--
 缺少必要参数 | 1000 | 缺少接口所需参数
 非法请求 | 1001 | 传入的订单id不是有效的订单号
 用户未登录 | 1106 | 用户未登录或session已过期
 密码输入错误 | 1203 | 交易密码输入错误
 未设置交易密码 | 1300 | 用户未设置交易密码
 账号已冻结，请修改密码或稍后重试 | 1500 |  交易密码输入错误超过三次，冻结
 充值失败 | 1670 | 调用充值失败（失败原因不固定，以错误信息为准）

 
 
## 充值结果查询

说明：充值结果查询

> 须知：当前查询策略
> 充值接口如果返回订单状态【处理中】，需要调用该接口来获取订单真正的状态。
> 客户端需限制调用间隔及调用次数，如果接口返回【1671：充值处理中】，则继续进行下次调用，直到接口返回成功或失败
> 如果调用次数到达上限，此时接口应该停止调用，并以最后一次调用结果作为前端的充值状态显示
> 该接口目前有三种状态显示，【成功：0】或【处理中:1671】以`result`的形式返回，【失败：1670】则以异常的形式抛出
##### 请求参数

	{
    	"jsonrpc": "2.0",
    	"method": "inquireRecharge",
    	"params": [{
            "order_id": "D2AD7043-F3D4-B896-F3E4-BB78FB148271"  //充值订单号
        }],
    	"id": 1
    }

##### 返回结果

	成功：
        {
          "jsonrpc": "2.0",
          "result": {
            "code": 0,
            "message": "充值成功"
          },
          "id": 1
        }
       成功目前会有两种状态，充值成功（code:0）、订单处理中（code:1671）
       
    失败：
        {
		  "jsonrpc": "2.0",
		  "error": {
		    "code": 1406,
		    "message": "商户不支持该卡交易"
		  },
		  "id": 1
		}
        
错误信息 | 错误码 | 错误说明
:--|:--|:--
缺少必要参数 | 1000 | 缺少接口所需参数
请求过于频繁 | 1002 | 超过限制查询次数
接口请求过期 | 1004 | 查询接口和充值接口调用间隔过长（当前是10秒）
用户未登录 | 1106 | 用户未登录或session已过期
充值失败 | 1670 | 因为失败的原因多种多样，具体错误信息查看message（失败的错误码都为1670）



## 用户提现

说明：用户提现操作

##### 请求参数

	{
        "jsonrpc": "2.0",
        "method": "withdraw",
        "params": [
            {   
                "cardno": "6214830121363633",   //银行卡号
            	"amount": 10,                   //提现总额
            	"trade_pwd": '123123'           //用户交易密码
            }
        ],
        "id": 1
    }
    
##### 返回结果

	成功：
		{
          "jsonrpc": "2.0",
          "result": {
            "code": 0,
            "message": "提现申请成功"
          },
          "id": 1
        }

	失败：
		{
          "jsonrpc": "2.0",
          "error": {
            "code": 1106,
            "message": "用户未登录"
          },
          "id": 1
        }

##### 所有错误情况说明

错误信息 | 错误码 | 错误说明
:--|:--|:--
交易密码不为空／银行卡号不为空 | 1000 | 缺少接口所需参数
接口调用过于频繁 | 1002 | 接口调用过于频繁
用户未登录 | 1106 | 用户未登录或session已过期
提现金额不合法 | 1110 | 多种提现金额不合法
密码输入错误 | 1203 | 交易密码不正确
用户未实名认证 | 1301 | 用户未实名认证
未绑定银行卡 | 1303 | 用户没有绑定银行卡
保存提现记录失败 | 1401 | 保存提现记录失败


## 提现费用

说明：获取用户提现手续费情况

##### 请求参数

	{
    	"jsonrpc": "2.0",
    	"method": "withdrawFee",
    	"params": [{
    	    "amount": 1
    	}],
    	"id": 1
    }

##### 返回结果

	成功：
        {
          "jsonrpc": "2.0",
          "result": {
            "code": 0,
            "message": "success",
            "data": {
              "basic_fee": "0.000",     //基本手续费
              "extra_fee": "0.000",     //额外手续费
              "total_fee": "0.00",      //总手续费
              "actual_amount": "1.00"   //实际到账
            }
          },
          "id": 1
        }
       
    失败：
        {
		  "jsonrpc": "2.0",
		  "error": {
		    "code": 1303,
		    "message": "未绑定银行卡"
		  },
		  "id": 1
		}
        
错误信息 | 错误码 | 错误说明
:--|:--|:--
缺少必要参数 | 1000 | 缺少接口所需参数
用户未登录 | 1106 | 用户未登录或session已过期
充值金额不合法 | 1107 | 充值金额必须为整型并且大于最低限额（当前为10元）
密码输入错误 | 1203 | 交易密码输入错误
未设置交易密码 | 1300 | 用户未设置交易密码
用户未实名认证 | 1301 | 用户未实名认证
未绑定银行卡 | 1303 | 用户没有绑定银行卡
保存充值记录失败 | 1406 | mysql服务写入失败或充值失败
充值失败 | 1670 | 调用充值失败（失败原因不固定，以错误信息为准）
账号已冻结，请修改密码或稍后重试 | 1500 |  交易密码输入错误超过三次，冻结


## 交易记录

说明：获取用户交易记录

##### 请求参数

	{
    	"jsonrpc": "2.0",
    	"method": "tradeRecords",
    	"params": [{
    	    "type": 2    //0: 转出 1：买入 2: 全部
    	}],
    	"id": 1
    }

##### 返回结果

	成功：
        {
          "jsonrpc": "2.0",
          "result": {
            "code": 0,
            "message": "success",
            "data": [
              {
                "id": "2277757",
                "uuid": "3BCD50DA-426B-12A0-13A6-614D6582172F",
                "type": "1",            //交易类型  1：买入（'+' 号）  0：转出（'-' 号）
                "amount": "10000.00",
                "datetime": "2016-09-19 11:50:50",
                "status": "400",        //交易状态 100：处理中（已受理） 200：成功 400：失败
                "bank": "招商银行(3633)",
                "bank_logo": "http://php1.wanglibao.com/pay//static/images/bank-logos/zsyh.png",
                "datetime": "2016-09-19 11:50:50",
                "detail": [                     //买入（转出）进度
                  {
                    "type": 1,
                    "type_to_cn": "买入已受理",
                    "amount": "10000.00",
                    "status": "200",            
                    "create_time": "2016-09-19 11:50:50"
                  },
                  {
                    "type": 1,
                    "type_to_cn": "买入已审核",
                    "amount": "10000.00",
                    "status": "200",
                    "create_time": "2016-09-19 11:50:50"
                  },
                  {
                    "type": "1",
                    "type_to_cn": "买入失败",
                    "amount": "10000.00",
                    "status": "400",
                    "create_time": "2016-09-19 11:50:50"
                  }
                ]
              },
              {
                "id": "2283444",
                "uuid": "89DE956E-F246-512E-A55E-14AFDEAB796D",
                "type": "0",
                "amount": "20338.81",
                "bank": "招商银行(3633)",
                "datetime": "2016-09-19 09:53:06",
                "status": "200",
                "detail": [
                  {
                    "type": "0",
                    "type_to_cn": "转出已受理",
                    "amount": "20,338.81",
                    "status": "200",
                    "create_time": "2016-09-17 07:09:06"
                  },
                  {
                    "type": "0",
                    "type_to_cn": "转出已审核",
                    "amount": "20,338.81",
                    "status": "200",
                    "create_time": "2016-09-17 07:09:06"
                  },
                  {
                    "type": "0",
                    "type_to_cn": "转出成功",
                    "amount": "20,338.81",
                    "status": "200",
                    "create_time": "2016-09-19 09:53:06"
                  }
                ]
              }
            ]
          },
       
    失败：
        {
		  "jsonrpc": "2.0",
		  "error": {
		    "code": 1303,
		    "message": "未绑定银行卡"
		  },
		  "id": 1
		}
        
错误信息 | 错误码 | 错误说明
:--|:--|:--
缺少必要参数 | 1000 | 缺少接口所需参数
用户未登录 | 1106 | 用户未登录或session已过期